<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>CondoServe - Seu produto sem sair de casa</title>

    <meta name="description" content="CondoServe">
    <meta name="author" content="Equipe Caminhapp">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    
    <meta name="google-signin-client_id" content="764680588695-8mpl4f0rqa1m4i68nih3bb3gq571m8q6.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="https://apis.google.com/js/platform.js?onload=onLoad" async defer></script>

  </head>
  <body>

    <div class="container-fluid">
	<div class="row">
		<div class="col-md-12">
			<div class="row" id="top">
				<div class="col-md-4">
					<div class="page-header">
						<h1>
							CondoServe <br><small style="font-size:19px;">Seu produto sem sair de casa</small>
						</h1>
					</div>
				</div>
				<div class="col-md-8">
					<ul class="nav nav-pills">
						<li class="nav-item">
							<a class="nav-link " href="index.html">Home</a>
						</li>
						<li class="nav-item">
							<a class="nav-link " href="produtos.html">Produtos</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="cadastroProduto.html">Cadastrar Produto</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="comoFunciona.html">Como Funciona</a>
						</li>						
					</ul>
					 <ul class="nav nav-pills" id="ulLogin">
						<li id="cadastrese"></li>
						<li> | </li>
						<li id="loginESair"></li>
			         </ul>
				</div>
			</div>
			<div class="row" id="formCadastroMorador">
				<div class="col-md-12">
					<h2> Cadastro de Morador
					</h2>				
					<form role="form"  OnSubmit="javascript:EnviarMorador();">
						<div class="form-group">							 
							<input required="true" type="text" class="form-control" id="nomeCompleto" placeholder="Nome Completo"/>
						</div>
						<div class="form-group  col-md-4">	
							<label for="dataNascimento">
								Data de Nascimento
							</label>						 
							<input required="true" class="form-control" type="date" id="dataNascimento" placeholder>
						</div>
						<div class="form-group col-md-4">							 
							<label for="condominios">Condomínio:</label>
							
							<select name="condominios" id="condominios" class="form-control">
							</select>
						</div>
						<div class="form-group  col-md-8">							 
							<input required="true" type="text" class="form-control" id="endereco" placeholder="Complemento"/>
						</div>

						<div class="form-group col-md-4">							 
							<input required="true" type="text" class="form-control" id="telefone1"  placeholder="Celular com DDD"/>
						</div>
						<div class="form-group col-md-4">							 
							<input type="text" class="form-control" id="telefone2"  placeholder="Ramal"/>
						</div>				
						<div class="form-group  col-md-6">							 
							<input required="true" type="email" class="form-control" id="email"  placeholder="Email"/>
						</div>
						<div class="form-group">
							 
							<label for="inputComprovanteEnd">
								Comprovante de endereço
							</label>
							<input type="file" class="form-control-file" id="comprovanteEnd" />
							<p class="help-block">
								* Conta de luz, gás, fatura, cartão de crédito.
							</p>
						</div>
						<button type="submit" class="btn btn-primary" id="btnCadastrarMorador" >
							Cadastrar
						</button>
					</form>	
					<div id="feedback"></div>									
				</div>
			</div>
			<div class="row" id="footer">
				<div class="col-md-12">
					<div class="row">
						<div class="col-md-4">
							<ul class="nav flex-column">
								<li class="nav-item">
									<a class="nav-link" href="comoFunciona.html">Como Funciona</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="produtos.html">Produtos</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="cadastroProduto.html">Cadastrar Produto</a>
								</li>
							</ul>
						</div>
						<div class="col-md-4" style="padding-top: 9px;">
							<p>
								Contato
							</p>
							<p>
								Tel.: (11) 5544-3344
							</p>
							<p>
								condoserve@gmail.com
							</p>
						</div>
						<div class="col-md-4" style="padding-top: 9px;">
							<p>
								Facebook
							</p>
							<p>
								Instagram
							</p>
							<p>
								<img alt="Redes Sociais" src="images\redes-sociais.jpg" >
							</p>
						</div>
					</div>
				</div>
			</div>
			<div class="row" id="quadroContato">
				<div class="col-md-12">
					 
					<address>
						 <strong>2020 por Bla bla</strong><br> São Paulo - SP, 12012-111 - contato@teste.com.br, Tel. (11) 5544-3322
					</address>
				</div>
			</div>
		</div>
	</div>
</div>

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/scripts.js"></script>
    
    <script>
	    $(document).ready(function(){
	    	checkIfLoggedIn();

	    	var urlStr = "http://localhost:6061/condominios";
	    	$.ajax({
	    		url : urlStr,
	    		type : "get",
	    		dataType : "json",
	    		success : function(data){
	    			var conteudo = "";
	    			var itens = [];
	    			for(var i = 0; i < data.length; i++){
	    				var nome = data[i].nomeCondominio;
	    				var idCondo = data[i].idCondominio;
	    				conteudo += "<option value='"+idCondo+"'>" + nome + "</option>";
	    				
	    			}
	    			document.getElementById("condominios").innerHTML = conteudo;
	    
	    		},
	    		error: function(erro){
	    			console.log(erro);
	    			
	    		}
	    	});
	    });
    	
    	function EnviarMorador(){
    		
    		// Exemplo de requisição POST
    		var ajax = new XMLHttpRequest();

    		// Seta tipo de requisição: Post e a URL da API
    		ajax.open("POST", "http://localhost:6061/moradores", true);
    		ajax.setRequestHeader("Content-type", "application/json");
    		
    		var nomeCliente = $("#nomeCompleto").val();
    		var dataNascimento = $("#dataNascimento").val();
    		var enderecoCliente = $("#endereco").val();
    		var telefoneContato1 = $("#telefone1").val();
    		var telefoneContato2 = $("#Telefone").val();
    		var email = $("#email").val();
    		var idCondo =  $("#condominios").val();
    		
    		var data = {
  				  "email": email,
  				  "nomeCliente": nomeCliente,
  				  "dataNascimento": dataNascimento,
  				  "enderecoCliente": enderecoCliente,
  				  "telefoneContato1": telefoneContato1,
  				  "telefoneContato2": telefoneContato2,
  				  "codigoComprovanteEnd": 1,
  				  "idCondominio": idCondo, 
  				  "idStatus": "A"
      		}

    		// Seta paramêtros da requisição e envia a requisição
    		ajax.send(JSON.stringify(data));

    		// Cria um evento para receber o retorno.
    		ajax.onreadystatechange = function() {
    		  
    		  // Caso o state seja 4 e o http.status for 200, é porque a requisiçõe deu certo.
    			if (ajax.readyState == 4 && ajax.status == 200) {
    		    
    				var data = ajax.responseText;
    			
    				window.location.href = "http://localhost:8080/app/login.html";
    			} 
    		} 

    	}
    	function checkIfLoggedIn()
    	{
    	  if(sessionStorage.getItem('myUserEntity') == null){
    	    //Redirect to login page, no user entity available in sessionStorage
	    	  var conteudo = "<a href='login.html';> Login</a>";
	    	  document.getElementById("loginESair").innerHTML = conteudo;
	    	  var conteudo2 = "<a href='cadastroMorador.html';>Cadastre-se</a>";
	    	  document.getElementById("cadastrese").innerHTML = conteudo2;
    	    
    	  } else {
    	    //User already logged in
    	    var userEntity = {};
    	    userEntity = JSON.parse(sessionStorage.getItem('myUserEntity'));
    	    var conteudo = "<a href='javascript:signOut();'> Sair</a>";
    	    document.getElementById("loginESair").innerHTML = conteudo;
    	    var conteudo2 = "<a>"+userEntity.Nome+"</a>";
    	    document.getElementById("cadastrese").innerHTML = conteudo2;
	    	
    	  }
    	}
    	
        function onLoad() {
            gapi.load('auth2', function() {
              gapi.auth2.init();
            });
          }  
        
	    function signOut(){
	    	onLoad();
	        var auth2 = gapi.auth2.getAuthInstance();
	        auth2.signOut().then(function () {
		          console.log('User signed out.');
		    	  var conteudo = "<a href='login.html';> Login</a>";
		    	  document.getElementById("loginESair").innerHTML = conteudo;
		    	  var conteudo2 = "<a href='cadastroMorador.html';>Cadastre-se</a>";
		    	  document.getElementById("cadastrese").innerHTML = conteudo2;
		    	  sessionStorage.clear();
	        });	        
	        
	    }
    </script>
  </body>
</html>