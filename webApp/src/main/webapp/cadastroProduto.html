<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>CondoServe - Seu produto sem sair de casa</title>

    <meta name="description" content="Source code generated using layoutit.com">
    <meta name="author" content="LayoutIt!">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

  </head>
  <body>

    <div class="container-fluid">
	<div class="row">
		<div class="col-md-12">
			<div class="row" id="top">
				<div class="col-md-4">
					<div class="page-header">
						<h1>
							CondoServe <br><small style="font-size:19px;">Seu produto sem sair de casa</small>
						</h1>
					</div>
				</div>
				<div class="col-md-8">
					<ul class="nav nav-pills">
						<li class="nav-item">
							<a class="nav-link " href="index.html">Home</a>
						</li>
						<li class="nav-item">
							<a class="nav-link " href="produtos.html">Produtos</a>
						</li>
						<li class="nav-item">
							<a class="nav-link active" href="cadastroProduto.html">Cadastrar Produto</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="comoFunciona.html">Como Funciona</a>
						</li>							
					</ul>
					 <ul class="nav nav-pills" id="ulLogin">
						<li id="cadastrese"></li>
						<li> | </li>
						<li id="loginESair"></li>
			         </ul>
				</div>
			</div>
			<div class="row" id="formCadastroProduto">
				<div class="col-md-12">
					<h2> Cadastro de Produto
					</h2>
					<form role="form" OnSubmit="javascript:EnviarProduto();">
						<div class="form-group col-md-8">							 
							<input required="true" type="text" class="form-control" id="nomeProduto" placeholder="Nome do Produto"/>
						</div>
						<div class="form-group col-md-8">							 
							<textarea required="true" class="form-control" id="detalheProduto" rows="3" placeholder="Detalhe do Produto"></textarea>
						</div>
						<div class="form-group col-md-6">							 
							<input required="true" type="text" class="form-control" id="marcaProduto" placeholder="Marca do Produto"/>
						</div>
						<div class="form-group col-md-4">							 
							<input required="true" type="text" class="form-control" id="valorProduto" placeholder="Valor do Produto"/>
						</div>	
						<!-- 
						<div class="form-group col-md-4">							 
							<label for="morador">Morador:</label>
							
							<select name="morador" id="morador" class="form-control">
							</select>
						</div>	 -->				
						<div class="form-group">							 
							<label for="imagemProduto">
								Imagem do Produto
							</label>
							<input type="file" class="form-control-file" id="imagemProduto" />
							<p class="help-block">
								* Verifique a qualidade da imagem.
							</p>
						</div>
						<button type="submit" class="btn btn-primary" id="btnCadastrarProduto" >
							Cadastrar
						</button>
					</form>										
				</div>
			</div>
			<div class="row" id="footer">
				<div class="col-md-12">
					<div class="row">
						<div class="col-md-4">
							<ul class="nav flex-column">
								<li class="nav-item">
									<a class="nav-link" href="comoFunciona.html">Como Funciona</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="produtos.html">Produtos</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="cadastroProduto.html">Cadastrar Produto</a>
								</li>
							</ul>
						</div>
						<div class="col-md-4" style="padding-top: 9px;">
							<p>
								Contato
							</p>
							<p>
								Tel.: (11) 5544-3344
							</p>
							<p>
								condoserve@gmail.com
							</p>
						</div>
						<div class="col-md-4" style="padding-top: 9px;">
							<p>
								Facebook
							</p>
							<p>
								Instagram
							</p>
							<p>
								<img alt="Redes Sociais" src="images\redes-sociais.jpg" >
							</p>
						</div>
					</div>
				</div>
			</div>
			<div class="row" id="quadroContato">
				<div class="col-md-12">
					 
					<address>
						 <strong>2020 por Bla bla</strong><br> São Paulo - SP, 12012-111 - contato@teste.com.br, Tel. (11) 5544-3322
					</address>
				</div>
			</div>
		</div>
	</div>
</div>

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/scripts.js"></script>
    
    <script>
    
	    $(document).ready(function(){
	    	checkIfLoggedIn();
	    	onLoad();
	    	var urlStr = "http://localhost:6061/moradores";
	    	$.ajax({
	    		url : urlStr,
	    		type : "get",
	    		dataType : "json",
	    		success : function(data){
	    			var conteudo = "";
	    			var itens = [];
	    			for(var i = 0; i < data.length; i++){
	    				var nome = data[i].nomeCliente;
	    				var idMorador = data[i].idMorador;
	    				conteudo += "<option value='"+idMorador+"'>" + nome + "</option>";
	    				
	    			}
	    			document.getElementById("morador").innerHTML = conteudo;
	    
	    		},
	    		error: function(erro){
	    			console.log(erro);
	    			
	    		}
	    	});
	    });
    	
    	function EnviarProduto(){
    		
    		// Exemplo de requisição POST
    		var ajax = new XMLHttpRequest();

    		// Seta tipo de requisição: Post e a URL da API
    		ajax.open("POST", "http://localhost:6060/produtos", true);
    		ajax.setRequestHeader("Content-type", "application/json");
    		
    		var descricaoProduto = $("#nomeProduto").val();
    		var detalheProduto = $("#detalheProduto").val();
    		var marcaProduto = $("#marcaProduto").val();
    		var valorProduto = $("#valorProduto").val();
    		var imagemProduto = $("#imagemProduto").val();
    		var diretorio = imagemProduto.split('\\');
    		var nomeFoto = diretorio[2];
    		
    		var data = {
				  "descricaoProduto": descricaoProduto,
				  "detalheProduto": detalheProduto,
				  "marcaProduto": marcaProduto,
				  "valorProduto": valorProduto,
				  "caminhoFoto": nomeFoto,
				  "idMorador": 5
    		}

    		// Seta paramêtros da requisição e envia a requisição
    		ajax.send(JSON.stringify(data));

    		// Cria um evento para receber o retorno.
    		ajax.onreadystatechange = function() {
    		  
    		  // Caso o state seja 4 e o http.status for 200, é porque a requisiçõe deu certo.
    			if (ajax.readyState == 4 && ajax.status == 200) {
    		    
    				var data = ajax.responseText;
    				
    				$('#exampleModalCenter').modal('show');
    			}
    		}    		
    	}

    	function checkIfLoggedIn()
    	{
    	  if(sessionStorage.getItem('myUserEntity') == null){
    	    //Redirect to login page, no user entity available in sessionStorage
	    	  var conteudo = "<a href='login.html';> Login</a>";
	    	  document.getElementById("loginESair").innerHTML = conteudo;
	    	  var conteudo2 = "<a href='cadastroMorador.html';>Cadastre-se</a>";
	    	  document.getElementById("cadastrese").innerHTML = conteudo2;
    	    
    	  } else {
    	    //User already logged in
    	    var userEntity = {};
    	    userEntity = JSON.parse(sessionStorage.getItem('myUserEntity'));
    	    var conteudo = "<a href='javascript:signOut();'> Sair</a>";
    	    document.getElementById("loginESair").innerHTML = conteudo;
    	    var conteudo2 = "<a>"+userEntity.Nome+"</a>";
    	    document.getElementById("cadastrese").innerHTML = conteudo2;
    	  }
    	}
    	
        function onLoad() {
            gapi.load('auth2', function() {
              gapi.auth2.init();
            });
        }
        
	    function signOut(){
	        var auth2 = gapi.auth2.getAuthInstance();
	        auth2.signOut().then(function () {
		          console.log('User signed out.');
		    	  var conteudo = "<a href='login.html';> Login</a>";
		    	  document.getElementById("loginESair").innerHTML = conteudo;
		    	  var conteudo2 = "<a href='cadastroMorador.html';>Cadastre-se</a>";
		    	  document.getElementById("cadastrese").innerHTML = conteudo2;
		    	  sessionStorage.clear();
	        });	        
	        
	    }
    </script>
  </body>
</html>