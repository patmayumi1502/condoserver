<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>CondoServe - Seu produto sem sair de casa</title>

    <meta name="description" content="CondoServe">
    <meta name="author" content="Equipe Caminhapp">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

  </head>
  <body>

    <div class="container-fluid">
	<div class="row">
		<div class="col-md-12">
			<div class="row" id="top">
				<div class="col-md-4">
					<div class="page-header">
						<h1>
							CondoServe <br><small style="font-size:19px;">Seu produto sem sair de casa</small>
						</h1>
					</div>
				</div>
				<div class="col-md-8">
					<ul class="nav nav-pills">
						<li class="nav-item">
							<a class="nav-link " href="index.html">Home</a>
						</li>
						<li class="nav-item">
							<a class="nav-link " href="produtos.html">Produtos</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="cadastroProduto.html">Cadastrar Produto</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="comoFunciona.html">Como Funciona</a>
						</li>						
					</ul>
					 <ul class="nav nav-pills" id="ulLogin">
						<li id="cadastrese"></li>
						<li> | </li>
						<li id="loginESair"></li>
			         </ul>
				</div>
			</div>
			<div class="row" id="detalheProduto">
				<div class="col-md-12">
					<div class="row">
						<div class="col-md-4" id="infoProduto">

						</div>
						<div class="col-md-8">
							<div class="tabbable" id="tabs-440853">
								<ul class="nav nav-tabs">
									<li class="nav-item">
										<a class="nav-link active show"  data-toggle="tab">Detalhes Produto</a>
									</li>
								</ul>
								<div class="tab-content">
									<div class="tab-pane active" id="panel-754431">
										<dl id="especificacoes">

										</dl> 
									</div>
								</div>
							</div> 
							<div id="faleComVendedor">
							</div>
							
						</div>
					</div>
				</div>
			</div>
			<div class="row" id="quadroAviso">
				<div class="col-md-12">
					<h2>
						Como Funciona
					</h2>
					<p>
							Para utilizar o CondoServe é muito simples. Cada vez que você interage com a plataforma, oferecendo ou comprando produtos e serviços, você acumula pontos que poderão ser trocados por descontos no aluguel de área comum dentro do seu condomínio. Não perca essa chance de alavancar suas vendas e ganhar benefícios.
					</p>
					<a class="btn" href="comoFunciona.html">Mais detalhes »</a>
				</div>
			</div>
			<div class="row" id="footer">
				<div class="col-md-12">
					<div class="row"> 
						<div class="col-md-4">
							<ul class="nav flex-column">
								<li class="nav-item">
									<a class="nav-link" href="comoFunciona.html">Como Funciona</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="produtos.html">Produtos</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="cadastroProduto.html">Cadastrar Produto</a>
								</li>
							</ul>
						</div>
						<div class="col-md-4" style="padding-top: 9px;">
							<p>
								Contato
							</p>
							<p>
								Tel.: (11) 5544-3344
							</p>
							<p>
								condoserve@gmail.com
							</p>
						</div>
						<div class="col-md-4"  style="padding-top: 9px;">
							<p>
								Facebook
							</p>
							<p>
								Instagram
							</p>
							<p>
								<img alt="Redes Sociais" src="images\redes-sociais.jpg" >
							</p>
						</div>
					</div>
				</div>
			</div>
			<div class="row" id="quadroContato">
				<div class="col-md-12">
					 
					<address>
						 <strong>2020 por Bla bla</strong><br> São Paulo - SP, 12012-111 - contato@teste.com.br, Tel. (11) 5544-3322
					</address>
				</div>
			</div>
		</div>
	</div>
</div>

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/scripts.js"></script>
    
	<script>
		var idMorador;
		var conteudo2 = "";
	    $(document).ready(function(){
	    	checkIfLoggedIn();
	    	onLoad();
	    	var url_string = window.location.href;
	    	var url = new URL(url_string);
	    	var id = url.searchParams.get("idProduto");
	    	var urlStr = "http://localhost:6060/produtos/"+id;
			var nomeProduto = "";
			var conteudo = "";
	    	$.ajax({
	    		url : urlStr,
	    		type : "get",
	    		dataType : "json",
	    		success : function(data){
	    			
	    			conteudo += "<h3>"+data.descricaoProduto+"</h3>";
	    			conteudo += "<div id='imagensDetalhe'><img src=\"images\\"+data.caminhoFoto+"\" class=\"img-thumbnail\"></div>";
	    			conteudo += "<span class='badge badge-default'>R$ "+data.valorProduto+"</span>";

	    			
	    			
	    			conteudo2 += "<dt>Nome:</dt>";
	    			conteudo2 += "<dd>"+data.descricaoProduto+"</dd>";	
	    			nomeProduto = data.descricaoProduto;
	    			conteudo2 += "<dt>Detalhes:</dt>";
	    			conteudo2 += "<dd>"+data.detalheProduto+"</dd>";
	    			conteudo2 += "<dt>Marca:</dt>";
	    			conteudo2 += "<dd>"+data.marcaProduto+"</dd>";
	    			conteudo2 += "<dt>Valor:</dt>";
	    			conteudo2 += "<dd>"+data.valorProduto+"</dd>";
	    			idMorador = data.idMorador;
	    			
	    	    	var urlStr2 = "http://localhost:6061/moradores/"+ idMorador;
	    	    	var conteudo3 = "";
	    	    	$.ajax({
	    	    		url : urlStr2,
	    	    		type : "get",
	    	    		dataType : "json",
	    	    		success : function(data){
	    	    			
	    	    			conteudo2 += "<dt>Vendedor:</dt>";
	    	    			conteudo2 += "<dd>"+data.nomeCliente+"</dd>";	
	    	    			conteudo2 += "<dt>Contato:</dt>";
	    	    			conteudo2 += "<dd>"+data.telefoneContato1+"</dd>";
	    	    			
	    	    			document.getElementById("especificacoes").innerHTML = conteudo2;
	    	    			var tel1 = data.telefoneContato1;
	    	    			var numeroCel = tel1.replace(/\D+/g, '');
	    	    			var link = "https://api.whatsapp.com/send?phone=55"+numeroCel+"&text=Olá%20tenho%20interesse%20no%20produto%20"+nomeProduto+".";
	    	    			conteudo3 += "<button type='button' class='btn btn-success'  onclick=\"window.open('"+link+"');\">";
	    	    			conteudo3 += "Fale com o vendedor";
	    	    			conteudo3 += "</button>";
	    	    			document.getElementById("faleComVendedor").innerHTML = conteudo3;
	    	    			
	    	    			conteudo += "<button type='button' class='btn btn-block btn-outline-primary' onclick=\"window.open('"+link+"');\" >Peça Ja!</button>";
	    	    			document.getElementById("infoProduto").innerHTML = conteudo;
	    	    		},
	    	    		error: function(erro){
	    	    			console.log(erro);
	    	    		}
	    	    	});
	    			
	    		},
	    		error: function(erro){
	    			console.log(erro);
	    		}
	    	});
	    	

	    });
	    
    	function checkIfLoggedIn()
    	{
    	  if(sessionStorage.getItem('myUserEntity') == null){
    	    //Redirect to login page, no user entity available in sessionStorage
	    	  var conteudo = "<a href='login.html';> Login</a>";
	    	  document.getElementById("loginESair").innerHTML = conteudo;
	    	  var conteudo2 = "<a href='cadastroMorador.html';>Cadastre-se</a>";
	    	  document.getElementById("cadastrese").innerHTML = conteudo2;
    	    
    	  } else {
    	    //User already logged in
    	    var userEntity = {};
    	    userEntity = JSON.parse(sessionStorage.getItem('myUserEntity'));
    	    var conteudo = "<a href='javascript:signOut();'> Sair</a>";
    	    document.getElementById("loginESair").innerHTML = conteudo;
    	    var conteudo2 = "<a>"+userEntity.Nome+"</a>";
    	    document.getElementById("cadastrese").innerHTML = conteudo2;
    	  }
    	}
    	
        function onLoad() {
            gapi.load('auth2', function() {
              gapi.auth2.init();
            });
          }	  
        
	    function signOut(){
	        var auth2 = gapi.auth2.getAuthInstance();
	        auth2.signOut().then(function () {
		          console.log('User signed out.');
		    	  var conteudo = "<a href='login.html';> Login</a>";
		    	  document.getElementById("loginESair").innerHTML = conteudo;
		    	  var conteudo2 = "<a href='cadastroMorador.html';>Cadastre-se</a>";
		    	  document.getElementById("cadastrese").innerHTML = conteudo2;
		    	  sessionStorage.clear();
	        });	        
	        
	    }
    </script>
  </body>
</html>